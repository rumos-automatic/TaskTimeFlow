# TaskTimeFlow 開発ロードマップ

## 📊 現在の進捗状況（2025-07-02更新）

### ✅ 完了フェーズ
- **Phase 2**: コア機能開発 - **完了**
  - タスクプール（かんばんボード）
  - タイムライン機能
  - カレンダービュー
  - クロスビュードラッグ&ドロップ
  - **📅 カレンダービューからのタスク作成機能（時間選択付き）**
  - **📱 モバイル最適化（タッチイベント、UI改善）**
  - **📋 タスクコピー機能**
  - **🔄 繰り返しタスク機能（完全版）** ← タスク完了時の自動生成対応
  - **✏️ カレンダータスク編集機能**
  - **📅 日付選択・変更機能**
  - **📝 タスクメモ機能（リッチテキストエディタ）**
  - **🐛 タイムライン作成タスクの同期問題完全修正**
  - **📝 タイムライン・カレンダーでのメモ確認・編集機能**
  - **⏱️ フォーカスモードでの休憩時間表示**
  - **⏰ タスク作成時間の動的計算機能**
  - **📋 タスク時間入力のドロップダウン化** ← NEW
- **Phase 4（一部）**: 高度な機能
  - **✅ ポモドーロタイマー機能 - 完了**
  - **✅ ストップウォッチ機能（作業/休憩トグル）- 完了**
  - **✅ AI機能UI実装 - 完了**
  - **✅ ユーザー設定画面 - 完了**

### 🚧 開発中
- **Phase 2.5**: ルーティング構造修正とLP開発（最優先）← NEW
- **Phase 3**: Google連携（ルーティング修正後に実施）
- **Phase 4**: 分析・レポート機能、AI機能実装、広告収益化

### 🚧 次回の開発予定（v0.10.0 - 最優先実施）
- **🔧 ルーティング構造の大規模リファクタリング**
  - 現状: すべてのページが認証必須（LPが存在しない）
  - 目標: 公開ページ（LP、料金、機能紹介）と認証必須ページ（アプリ）の分離
  - ルートグループ導入でクリーンなURL構造を実現
  - SEO最適化とマーケティング効果の向上
  - 実装詳細: `/docs/domain-routing-strategy.md`参照
  - **実施理由**: 
    - 広告収益化の前提条件（AdSense審査にLPが必須）
    - SEO効果は3-6ヶ月かかるため早期着手が重要
    - 技術的負債の削減（今なら影響範囲が限定的）

### 🎯 最新の修正・機能追加（v0.9.8 - 2025-07-02）
- **📋 タスク時間入力をドロップダウン形式に統一**
  - 全てのビュー（タスクプール、タイムライン、カレンダー）で実装
  - 15分から8時間までの12段階の選択肢を提供
  - タスク詳細モーダルの編集画面にも適用
  - 数値入力の煩雑さを解消しUXを向上
  - モバイルでの操作性が大幅に改善
  - タイムラインでは利用可能時間に最も近い選択肢を自動選択

### 🎯 前回の修正・機能追加（v0.9.7 - 2025-07-02）
- **⏰ タイムラインでのタスク作成時間の動的計算機能を実装**
  - タスク作成時に60分固定だった問題を解決
  - 次のタスクまでの利用可能時間を自動計算
  - 利用可能時間がない場合は30分をデフォルトに設定
  - カレンダービューのデフォルト時間も30分に統一
  - calculateAvailableDuration関数による賢い時間推定
  - 最大120分（2時間）までの制限で現実的な時間設定

### 🎯 前々回の修正・機能追加（v0.9.6 - 2025-07-02）
- **⏱️ フォーカスモードに休憩時間表示機能を実装**
  - 今日の休憩時間を緑色で表示（作業時間は紫色）
  - 作業時間と休憩時間を分けて記録・表示
  - リアルタイムで休憩時間が更新される仕組み
  - 休憩時間専用のbreak_time_logsテーブルを作成（Supabase MCP使用）
  - ストップウォッチモードでの休憩中もリアルタイムカウント

### 🎯 以前の修正・機能追加（v0.9.5 - 2025-07-02）
- **📝 タイムライン・カレンダービューでのメモ確認・編集機能実装**
  - タイムラインビューでタスクタイトルクリックによるメモ確認・編集
  - カレンダービューでも同様のメモ確認・編集機能を追加
  - メモがあるタスクには黄色のFileTextアイコンと「メモ」ラベルを表示
  - タスクプールと統一された操作感を実現
  - ホバー時のUI改善（カーソルポインター、色変化）

### 🎯 前回の修正・機能追加（v0.9.4 - 2025-07-02）
- **☕ ストップウォッチ作業/休憩トグル機能実装**
  - 作業モード（青）と休憩モード（緑）の切り替え機能
  - 休憩中は時間カウントするが作業時間には加算しない
  - 視覚的インジケーターで現在のモードを明確に表示
  - タイマーモードとは独立した作業/休憩管理

### 🎯 前回の修正・機能追加（v0.9.3 - 2025-07-01）
- **🐛 重要バグ修正 - タイムライン作成タスクの同期問題完全解決**
  - スマホでタイムライン作成タスクがタスクプールに表示される問題を修正
  - 根本原因：moveTaskToTimeline関数でscheduledDate/scheduledTimeがDBに保存されていなかった
  - TaskService.updateTaskによるタスクスケジュール情報の永続化実装
  - リアルタイム同期でnullに戻る問題を完全解決
  - PCとスマホで完全に一貫した動作を実現
- **🔧 開発品質向上**
  - TypeScriptビルドエラー修正（TaskService.updateTask引数修正）
  - ESLint警告修正（useCallback依存関係最適化）
  - Vercelデプロイ時のコンパイルエラー完全解決

### 🎯 前回の修正・機能追加（v0.9.2 - 2025-06-30）
- **📱 タスク編集機能の大幅改善**
  - スマホ版タイムラインでタスク所要時間編集が反映されない問題を修正
  - 数値入力フィールドの操作性を根本的に改善
  - 数字の削除・編集が自由にできるように修正
  - PC・スマホ両方で快適な入力体験を実現

### 🎯 前回の修正・機能追加（v0.9.1 - 2025-06-29）
- **📅 月単位ナビゲーション機能**
  - 前月・次月への移動ボタン実装
  - ダブルシェブロンアイコンで視覚的区別
  - 日本語ツールチップによる操作性向上

### 🎯 前回の修正・機能追加（v0.9.0 - 2025-06-29）
- **🤖 AI機能UIの実装**
  - ヘッダーバーにAIチャットアイコン追加
  - 開発中プレースホルダー画面
  - 全ビュー（モバイル/デスクトップ）対応
- **⚙️ ユーザー設定画面の実装**
  - 一般設定（プロフィール、タイムゾーン、言語）
  - APIキー設定（OpenAI、Claude、Gemini）
  - 通知設定（デスクトップ、サウンド、メール）
  - 外観設定（テーマ、アニメーション）
- **🔐 APIキー管理機能**
  - user_api_keysテーブル作成
  - 暗号化保存対応（デモ実装）
  - プロバイダー別管理

### 🎯 前回の修正・機能追加（v0.8.0 - 2025-06-29）
- **🔄 繰り返しタスク機能の完全実装**
  - タスク完了時の自動生成機能追加
  - 繰り返し属性の完全引き継ぎ実現
  - データベース保存・読み込み対応
  - 紫色アイコンで視覚的識別
- **🔗 認証エラー修正**
  - URL表示のauth_callback_failedエラー自動クリア
  - 不要な認証処理のスキップ
- **🐛 バグ修正**
  - 繰り返しタスク属性引き継ぎ問題解決
  - TypeScript型定義の不整合修正

### 🎯 前回の修正・機能追加（v0.7.0 - 2025-06-29）
- **📅 カレンダー完全体験の実現**
  - デスクトップ: タスク名クリックで編集モード
  - モバイル: 色付きドットタップで編集
  - 任意日付への作成・移動機能
  - HTML5 dateピッカーによる直感的UI
- **⚠️ 日付処理根本修正**
  - UTC時刻変換問題を完全解決
  - formatDateForDatabase/parseDateFromDatabase実装
  - 7/13→7/12のずれ問題完全修正
- **🎯 UI/UX改善**
  - 日付ナビゲーション位置固定（連続クリック誤操作防止）
  - 固定幅レイアウトによる一貫したボタン配置
  - フォーム統一デザイン改善
- **🔒 データセキュリティ強化**
  - クロスユーザーデータ汚染問題修正
  - ユーザー所有権追跡機能実装
  - ローカルデータ移行の安全性確保

### 🛠️ 過去の修正（v0.6.2以前）
- **Vercel TypeScript ビルドエラー修正**
- **タイムライン反映問題修正**
- **モバイル版プラスボタンの無限増殖バグ修正**
- **ポモドーロタイマーの休憩時間バグ修正**

### 📈 プロジェクト統計（v0.9.8時点）
- **コンポーネント数**: 32個（React TSX）← AI・設定関連コンポーネント追加
- **ライブラリファイル数**: 23個（TypeScript）← 時間計算機能追加
- **総TypeScriptファイル数**: 66個
- **実装済み機能数**: 20個の主要機能（ドロップダウン時間選択追加）
- **データベーステーブル**: 8個（Supabase）← break_time_logs追加
- **ビルドサイズ**: ~308KB（圧縮後）
- **開発進捗**: Phase 2完了、Phase 4の56%完了
- **バグ修正**: 累計31個の不具合を解決
- **UX改善**: 累計15個の改善実施（+1個）← ドロップダウン化

### 🎯 開発効率性（v0.9.8）
- **MVP完成度**: 99%（UI統一による完成度向上）
- **カレンダー機能**: 100%（作成・編集・日付選択・統一された時間選択）
- **タスク管理**: 100%（CRUD・コピー・繰り返し・メモ・ドロップダウン対応）
- **UI/UX**: 100%（全ビューで統一されたUX実現）
- **モバイル対応**: 99%（ドロップダウンで操作性向上）
- **データ同期**: 98%（全機能で安定動作）
- **自動化**: 96%（時間計算とUI選択の連携）
- **AI準備**: 40%（UI完了、APIキー管理完了、実装待ち）
- **コード品質**: 97%（UI統一によるコード整理）

## 全体スケジュール（約3ヶ月）

```
Phase 1: 基盤構築（2週間）              ✅ 完了
Phase 2: コア機能開発（4週間）          ✅ 完了
Phase 2.5: ルーティング修正とLP（2週間）🚧 最優先実施中 ← NEW
Phase 3: Google連携（3週間）            📅 Phase 2.5後に実施
Phase 4: 高度な機能（3週間）            🚧 一部完了
Phase 5: 商用化準備（2週間）            📅 計画中
```

### 🏆 現在の達成状況
- **Phase 1-2**: 100% 完了
- **Phase 2.5**: 0% （最優先開発項目） ← NEW
- **Phase 3**: 0% （Phase 2.5完了後に開始）
- **Phase 4**: 56% 完了（ポモドーロ、AI UI、設定画面、休憩時間、時間計算、ドロップダウン実装済み）
- **Phase 5**: 0%
- **全体進捗**: 約56%（UI/UX改善により進捗）

## Phase 1: 基盤構築（2週間）

### Week 1: 環境構築とプロジェクトセットアップ
- [ ] Turborepoによるモノレポ構築
- [ ] Next.js + TypeScriptのセットアップ
- [ ] NestJS + Prismaのセットアップ
- [ ] Dockerによる開発環境構築
- [ ] CI/CD パイプラインの設定（GitHub Actions）
- [ ] ESLint、Prettier、Huskyの設定

### Week 2: 認証システムと基本UI
- [ ] Supabase Authの統合
- [ ] Google OAuth実装
- [ ] 基本的なレイアウトコンポーネント
- [ ] テーマシステムの実装（ガラスモーフィズム含む）
- [ ] Storybookの設定とコンポーネントカタログ

**成果物**: 
- ログイン可能な基本アプリケーション
- デザインシステムの基盤

## Phase 2: コア機能開発（4週間）

### Week 3-4: かんばんボード
- [x] タスクモデルの実装（Zustandストア）
- [x] かんばんボードUIの実装（タスクプール）
- [x] タスクカードコンポーネント
- [x] ドラッグ&ドロップ機能（@dnd-kit）
- [x] タスクCRUD操作
- [x] フィルタリング（カテゴリタブ）

### Week 5-6: タイムライン機能とクロスビュー連携
- [x] カレンダービューの実装
- [x] タイムラインUIコンポーネント
- [x] タスクの時間割り当て機能
- [x] ドラッグによる時間変更
- [x] 日/週/月ビューの切り替え（カレンダー/タイムライン）
- [x] **クロスビュードラッグ&ドロップ実装（完了）**
- [x] かんばん⇔タイムライン間の状態同期

**成果物**: 
- 動作するかんばんボード
- 基本的なタイムライン機能
- クロスビュードラッグ&ドロップ機能

## Phase 2.5: ルーティング構造修正とLP開発（2週間）← NEW 最優先

### Week 7: ルーティング構造のリファクタリング
- [ ] ルートグループの導入（(marketing)、(legal)、(auth)、app/）
- [ ] AuthGuardをapp/配下のみに限定
- [ ] middleware.tsの実装（認証制御）
- [ ] 公開ページと認証必須ページの分離
- [ ] リダイレクトロジックの実装
- [ ] 既存ページの移動（/→/app/workspace）

### Week 8: LP・マーケティングページ開発
- [ ] LPトップページの作成（/）
- [ ] 機能紹介ページ（/features）
- [ ] 料金プランページ（/pricing）
- [ ] 会社情報ページ（/about）
- [ ] お問い合わせページ（/contact）
- [ ] SEO最適化（メタタグ、構造化データ）
- [ ] OGP対応（ソーシャルメディア共有）

**成果物**: 
- 公開ページと認証ページの分離
- SEO最適化されたLP
- マーケティング基盤の確立

## Phase 3: Google連携（3週間）

### Week 9: Google API統合準備
- [ ] Google Cloud Projectの設定
- [ ] OAuth同意画面の設定
- [ ] API認証フローの実装
- [ ] トークン管理システム

### Week 10: Googleカレンダー連携
- [ ] Calendar API統合
- [ ] イベントの双方向同期
- [ ] 同期IDによる重複防止
- [ ] 競合解決ロジック
- [ ] Webhook設定（Push通知）

### Week 11: Google Todo連携
- [ ] Tasks API統合
- [ ] タスクリストの同期
- [ ] タスクの双方向同期
- [ ] 同期状態のUI表示

**成果物**: 
- Google連携が動作するアプリケーション
- リアルタイム同期機能

## Phase 4: 高度な機能（3週間）

### Week 12: ポモドーロタイマー & AI機能UI
- [x] タイマーコンポーネントの実装
- [x] 作業セッション管理（25分作業/5分休憩）
- [x] 通知機能（ブラウザ通知）
- [x] タスクとの連携
- [x] 統計情報の記録（完了ポモドーロ数）
- [x] **AI機能UIの実装（チャットアイコン、ダイアログ）**
- [x] **ユーザー設定画面の実装**
- [x] **APIキー管理機能の実装**

### Week 13: AI機能実装 & 分析機能
- [ ] AI機能の実装
  - [ ] チャット形式でのタスク作成
  - [ ] スクリーンショット解析
  - [ ] 自然言語処理によるタスク分解
- [ ] Edge APIでのLLM連携
- [ ] 完了タスク一覧画面の実装
- [ ] 日別・週別・月別の統計表示
- [ ] データビジュアライゼーション（Chart.js/Recharts）
- [ ] 生産性指標の計算とレポート
- [ ] タスクログ機能の実装
- [ ] エクスポート機能（CSV/PDF）

### Week 14: パフォーマンス最適化 & 広告収益化
- [ ] 仮想スクロールの実装
- [ ] 画像・アセットの最適化
- [ ] Service Workerによるオフライン対応
- [ ] Lighthouseスコアの改善
- [ ] **広告収益化機能の実装**
  - [x] プライバシーポリシーページ作成
  - [x] 利用規約ページ作成
  - [ ] Google AdSenseアカウント申請・審査通過
  - [ ] 広告コンポーネントの開発（GoogleAdSense, AdPlaceholder）
  - [ ] ユーザーのサブスクリプションステータスに基づく条件付き表示
  - [ ] 広告配置の最適化（A/Bテスト）
- [ ] **ランディングページ（LP）開発**
  - [ ] LPのコンテンツ設計（価値提案、機能紹介、料金プラン）
  - [ ] コンバージョン最適化デザイン
  - [ ] ヒーローセクション（キャッチコピー、CTA）
  - [ ] 機能紹介セクション（3画面UIの説明）
  - [ ] 料金プランセクション
  - [ ] FAQ・お客様の声セクション
  - [ ] SEO最適化（メタタグ、構造化データ）

**成果物**: 
- フル機能のアプリケーション
- 分析・レポート機能搭載
- パフォーマンスが最適化されたUX
- 広告収益化による無料プランの持続可能性確保

## Phase 5: 商用化準備（2週間）

### Week 15: 決済システムとプラン管理
- [ ] Stripe統合
- [ ] サブスクリプションプラン実装
- [ ] 使用制限の実装（無料/有料）
- [ ] 決済フローのテスト

### Week 16: リリース準備
- [ ] プロダクション環境構築
- [ ] セキュリティ監査
- [ ] ドキュメント整備
- [ ] **マーケティングサイト（LP）最終調整**
  - [ ] A/Bテストの実施
  - [ ] コンバージョン率の最適化
  - [ ] レスポンシブデザインの完全対応
  - [ ] ページ読み込み速度の最適化
  - [ ] Google Analytics/Tag Manager設定
  - [ ] ソーシャルメディア連携（OGP設定）
- [x] 利用規約・プライバシーポリシー（実装済み）

**成果物**: 
- リリース可能な製品
- 運用ドキュメント

## 各フェーズの注意点

### Phase 1
- **リスク**: 技術選定の誤り
- **対策**: プロトタイプによる早期検証

### Phase 2
- **リスク**: UXの複雑化
- **対策**: ユーザビリティテストの実施

### Phase 3
- **リスク**: API制限・レート制限
- **対策**: キューシステムの実装、エラーハンドリング

### Phase 4
- **リスク**: パフォーマンス劣化
- **対策**: 継続的なパフォーマンス測定

### Phase 5
- **リスク**: セキュリティ脆弱性
- **対策**: セキュリティ監査、ペネトレーションテスト

## マイルストーン

1. **M1（Week 2）**: ログイン可能なアプリ
2. **M2（Week 6）**: かんばん＋タイムラインMVP
3. **M3（Week 9）**: Google連携完了
4. **M4（Week 12）**: フル機能版完成
5. **M5（Week 14）**: 商用版リリース

## 開発チーム構成（想定）

### 1人開発の場合
- 上記スケジュールで進行
- 各フェーズで外部レビューを依頼

### チーム開発の場合
- **フロントエンド**: 1-2名
- **バックエンド**: 1名
- **デザイン/UX**: 1名（パートタイム）

## 次のステップ

1. **技術検証**: 選定した技術スタックのPOC作成
2. **デザイン詳細**: FigmaでのUIモックアップ作成
3. **開発環境構築**: Phase 1の開始

---

このロードマップについて、調整したい部分や懸念事項があれば教えてください！